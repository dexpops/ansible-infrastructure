---

- name: Check if swapfile exists
  stat:
    path: "{{bootstrap_os__swap_file}}"
  register: file_result

- name: Create swap script from template
  become: True
  template:
    src: create_swap.sh.j2
    dest: /etc/create_swap.sh
    owner: root
    mode: 0744
  register: create_swap_result
  when:
    - not file_result.stat.exists

- name: Create swap files
  become: True
  command: "/bin/bash /etc/create_swap.sh"
  register: create_swap_result
  when:
    - not file_result.stat.exists

- name: Creating the systemd unit file
  become: True
  template:
    src: service.swap.j2
    dest: "{{bootstrap_os__swap_service_file}}"

- name: Start swap service
  become: True
  systemd:
    state: started
    name: "{{ bootstrap_os__swap_service_name }}"
    daemon_reload: yes